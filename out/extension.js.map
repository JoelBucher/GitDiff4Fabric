{"version":3,"file":"extension.js","sourceRoot":"","sources":["../src/extension.ts"],"names":[],"mappings":"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","sourcesContent":["import * as vscode from 'vscode';\nimport fetch from 'node-fetch';\nimport * as fs from 'fs';\nimport * as path from 'path';\n\ninterface WorkspacePick extends vscode.QuickPickItem {\n    id: string;\n}\n\nexport function activate(context: vscode.ExtensionContext) {\n    const disposable = vscode.commands.registerCommand(\n        'fabric-auth-demo.login',\n        async () => {\n            try {\n                // Step 1: Get Microsoft session\n                const session = await vscode.authentication.getSession(\n                    'microsoft',\n                    ['https://analysis.windows.net/powerbi/api/.default'],\n                    { createIfNone: true }\n                );\n\n                if (!session) {\n                    vscode.window.showErrorMessage('Login failed.');\n                    return;\n                }\n\n                const token = session.accessToken;\n\n                // Step 2: Call Fabric (Power BI) API\n                const response = await fetch(\n                    'https://api.powerbi.com/v1.0/myorg/groups',\n                    {\n                        headers: {\n                            Authorization: `Bearer ${token}`\n                        }\n                    }\n                );\n\n                if (!response.ok) {\n                    const text = await response.text();\n                    vscode.window.showErrorMessage(\n                        `API error: ${response.status} ${text}`\n                    );\n                    return;\n                }\n\n                const data = await response.json();\n\n                // Step 3: Show result\n                const workspaceCount = data.value?.length ?? 0;\n\n                vscode.window.showInformationMessage(\n                    `Logged in as ${session.account.label}. Found ${workspaceCount} workspaces.`\n                );\n            } catch (err: any) {\n                vscode.window.showErrorMessage(\n                    `Error: ${err.message || err}`\n                );\n            }\n        }\n    );\n\n    context.subscriptions.push(disposable);\n\n    const downloadCommand = vscode.commands.registerCommand('fabric-auth-demo.downloadNotebooks', async () => {\n        try {\n            // 1. Get Session\n            const session = await vscode.authentication.getSession('microsoft', \n                ['https://analysis.windows.net/powerbi/api/.default'], \n                { createIfNone: true }\n            );\n\n            // 2. Fetch Workspaces\n            const wsResponse = await fetch('https://api.powerbi.com/v1.0/myorg/groups', {\n                headers: { Authorization: `Bearer ${session.accessToken}` }\n            });\n            const wsData: any = await wsResponse.json();\n            const workspaces = wsData.value || [];\n\n            // 3. User selects Workspace\n            const selectedWs = await vscode.window.showQuickPick(\n                workspaces.map((ws: any) => ({ \n                    label: ws.name, \n                    description: ws.id, // Good for the user to see\n                    id: ws.id \n                })),\n                { placeHolder: 'Select a workspace' }\n            ) as WorkspacePick | undefined; // Cast the result\n\n            if (!selectedWs) return;\n\n            // 4. Fetch Notebooks (In Fabric, these are \"items\" of type \"Notebook\")\n            // Note: Using the Fabric API endpoint\n            const itemsResponse = await fetch(`https://api.fabric.microsoft.com/v1/workspaces/${selectedWs.id}/items`, {\n                headers: { Authorization: `Bearer ${session.accessToken}` }\n            });\n            const itemsData: any = await itemsResponse.json();\n            const notebooks = (itemsData.value || []).filter((i: any) => i.type === 'Notebook');\n\n            if (notebooks.length === 0) {\n                vscode.window.showInformationMessage('No notebooks found in this workspace.');\n                return;\n            }\n\n            // 5. Download each notebook\n            const workspaceFolder = vscode.workspace.workspaceFolders?.[0].uri.fsPath;\n            if (!workspaceFolder) {\n                vscode.window.showErrorMessage('Please open a folder in VS Code first.');\n                return;\n            }\n\n            const downloadFolder = path.join(workspaceFolder, 'fabric_notebooks');\n            if (!fs.existsSync(downloadFolder)) fs.mkdirSync(downloadFolder);\n\n            for (const nb of notebooks) {\n                // Fetch the notebook definition\n                const defResponse = await fetch(`https://api.fabric.microsoft.com/v1/workspaces/${selectedWs.id}/items/${nb.id}/getDefinition`, {\n                    method: 'POST',\n                    headers: { Authorization: `Bearer ${session.accessToken}` }\n                });\n                \n                // Note: Fabric returns definition as base64 parts. \n                // For simplicity, we're saving the metadata. \n                // Real .ipynb conversion requires parsing the 'parts' array.\n                const fileData = await defResponse.json();\n                fs.writeFileSync(\n                    path.join(downloadFolder, `${nb.displayName}.json`), \n                    JSON.stringify(fileData, null, 2)\n                );\n            }\n\n            vscode.window.showInformationMessage(`Downloaded ${notebooks.length} notebooks to /fabric_notebooks`);\n\n        } catch (err: any) {\n            vscode.window.showErrorMessage(`Error: ${err.message}`);\n        }\n    });\n\n    context.subscriptions.push(downloadCommand);\n}\n\nexport function deactivate() {}\n"]}